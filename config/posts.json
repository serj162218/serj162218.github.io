{
  "posts": [
    {
      "content": "用telegram的bot寫了點小工具，\r\n用Webhook的話記得php那邊要這樣接資料\r\n```php=\r\n// Takes raw data from the request\r\n$json = file_get_contents('php://input');\r\n// Converts it into a PHP object\r\n$lastMsg = json_decode($json, true);\r\n```\r\n測試的時候用getUpdates\r\ngetUpdate version\r\n```php=\r\n $url = \"https://api.telegram.org/bot.../getUpdates\";\r\n $s = json_decode(file_get_contents($url), true);\r\n $msgList = [];\r\n foreach ($s['result'] as $v) {\r\n     $msgList[] = $v;\r\n }\r\n $lastMsg = $msgList[count($msgList) - 1];\r\n ```\r\n #用webhook就不能用getUpdates\r\n\r\n 看Webhook有沒有異常，pending_updates不是0的話表示有異常訊息\r\nhttps://api.telegram.org/bot.../getWebhookInfo\r\n\r\n清空pending_updates\r\nhttps://api.telegram.org/bot.../setWebhook?url=webhook_url&drop_pending_updates=true\r\n\r\n啟動webhook\r\nhttps://api.telegram.org/bot.../setWebhook?url=webhook_url\r\n\r\n關閉 webhook\r\nhttps://api.telegram.org/bot.../setWebhook?url=\r\n\r\n希望bot是自己私人用的，就在webhook的php那邊加上判斷來源id的部分\r\n```php=\r\n$allowID = [\r\n    \"ID_1\",\r\n    \"ID_2\"\r\n];\r\nif(!in_array($lastMsg['message']['from']['id'],$allowID)) return false;\r\n```\r\n\r\n因為webhook不太好看有沒有記錄傳進來，所以我用了個資料表專門記錄傳進來的資料\r\n",
      "data": {
        "title": "Telegram Bot 開發心得",
        "date": "2022-07-25 17:03:49",
        "tags": [
          "program"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "telegram-bot-kai-fa-xin-de"
    },
    {
      "content": "複製到剪貼簿\r\n```js=\r\n    <div onclick=\"copy(this)\">text for copying.</div>\r\n    function copy(element) {\r\n        console.log($(element));\r\n        let str = $(element).text();\r\n        navigator.clipboard.writeText(str).then(() =>\r\n            alert(\"copied\");\r\n        );\r\n    };\r\n```\r\n",
      "data": {
        "title": "常用的程式碼 - Javascript",
        "date": "2022-07-25 14:31:42",
        "tags": [
          "常用的程式碼"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "chang-yong-de-cheng-shi-ma-javascript"
    },
    {
      "content": "創建新欄位\r\n在TABLE內新增欄位\r\nALTER TABLE 資料表名稱 ADD COLUMN 欄位名稱 形態(長度);\r\nALTER TABLE member ADD COLUMN tg_id int(64) NOT NULL AFTER FB_id, ADD INDEX(tg_id);\r\n在TABLE內新增欄位，欄位必須加入INDEX並且設定DEFAULT值\r\nALTER TABLE 資料表名稱 ADD COLUMN 欄位名稱 形態(長度), ADD INDEX(欄位名稱);\r\n\r\n\r\n刪除所有問號\r\nUPDATE `test` SET `content`= REPLACE(content, '?', '') WHERE `content` LIKE \"%?%\"\r\n\r\n正規表達式\r\nUPDATE `test` SET `msg`=REGEXP_REPLACE(msg,'(.*)( $)','\\\\1') WHERE msg REGEXP '.* $'\r\n\r\n查所有外來鍵\r\nSELECT * FROM information_schema.TABLE_CONSTRAINTS WHERE CONSTRAINT_TYPE = \"FOREIGN KEY\" AND CONSTRAINT_SCHEMA = \"test\"",
      "data": {
        "title": "常用的程式碼 - MySQL",
        "date": "2022-07-13 11:49:01",
        "tags": [
          "常用的程式碼"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "chang-yong-de-cheng-shi-ma-mysql"
    },
    {
      "content": "git add --all :/ 加入所有有修改的檔案\r\n(在根目錄 git add . 是一樣的效果)\r\ngit add -u 檔名有改/刪除的話用這個\r\ngit config --global --list\r\ngit reset HEAD filename 取消git add的檔案\r\ngit stash 暫存目前修改的狀態，然後還原成原本的樣子(untrach的file不會被暫存)\r\ngit stash pop 還原最新一筆stash\r\ngit stash list 列出所有暫存\r\ngit commit -m \"註解\" commit直接下註解",
      "data": {
        "title": "常用的程式碼 - git",
        "date": "2022-07-13 11:42:03",
        "tags": [
          "常用的程式碼"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "chang-yong-de-cheng-shi-ma-git"
    },
    {
      "content": "ps aux|grep master //查所有socket的執行緒\r\nss -nlp|grep 5000 //5000是port 查對應的pid用\r\nkill -15 {pid} 砍pid的程式，會跟著砍子程式，程式當機會砍不掉\r\nkill -9 {pid} 強制砍pid的程式，子程式的父pid會變1\r\nphp server_global_customer.php 可以開socket\r\ncrontab -e 編輯crontab\r\n-l 看crontab\r\n-r 全部刪除\r\n\r\n查檔案\r\nfind . -name \"*.txt\"\r\n\r\nkill -USR1 {pid} 熱重啟(socket主程式修改的話要砍掉重開)\r\ntail -f swoole.log 一直偵測log的最新訊息\r\ntail -f swoole.log | grep \"關鍵字\" 偵測關鍵字\r\ncat swoole.log | grep \"關鍵字\" 印出所有有關鍵字的\r\necho > swoole.log 清空log\r\ncat swoole.log | grep \"關鍵字\" -C 5 印出關鍵字與上下五行\r\ncat swoole.log | grep \"關鍵字\" > text.log 把log寫進text.log\r\n\r\ngit config --global  --list\r\n\r\ngrep -Frnw '.' -e '登入頁面' 目錄中找關鍵字\r\n-F 用簡單的字串查詢\r\n-r recursive\r\n-n 列出Line\r\n-w 字串全部對上才會顯示\r\n\r\nnetstat -tulpn | grep LISTEN 查PORT+PID",
      "data": {
        "title": "常用的程式碼 - 指令",
        "date": "2022-07-13 11:38:45",
        "tags": [
          "常用的程式碼"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "chang-yong-de-cheng-shi-ma-zhi-ling"
    },
    {
      "content": "\r\n```php=\r\n    //SELECT\r\n    Yii::app()->db->createCommand(\"SELECT * FROM test WHERE id = 1\")->queryAll();\r\n    //UPDATE, DELETE, INSERT\r\n    Yii::app()->db->createCommand(\"...\")->execute();\r\n\r\n    //Model Search\r\n    //By Attributes\r\n    $member = Member::model()->findByAttributes(['role' => 1]);\r\n    //Primary key, ex: id = 1\r\n    $member = Member::model()->findByPk(1);\r\n\r\n    //transaction start\r\n    $transaction = Yii::app()->db->beginTransaction();\r\n    //commit\r\n    $transaction->commit();\r\n    //rollback\r\n    $transaction->rollback();\r\n\r\n    //request\r\n    $request = app()->request;\r\n    //GET, default = 1\r\n    $id = $request->getQuery('id', '1');\r\n    //POST\r\n    //is this from post\r\n    if($request->isPostRequest){...}\r\n    //getPost, default = 1\r\n    $id = $request->getPost('id', '1');\r\n\r\n    //dataProvider by array data\r\n    $dataProvider = new CArrayDataProvider($data, [\r\n    'sort' => array(\r\n        'defaultOrder' => 'id ASC',\r\n        'attributes' => array(\r\n            \"id\", \"count\" //可以點擊排序\r\n        )\r\n    ),\r\n]);\r\n\r\n```\r\n\r\nModel 配 GridView 要用到FK的時候\r\n在model內命名一個public $var;\r\nmodel的rules的on => search前面加上要查詢的FK\r\n```php=\r\narray('id, content, type', 'safe', 'on' => 'search')\r\n```\r\n1. 在model內有用relations\r\n```php=\r\n$criteria->with = ['orig'];\r\n$criteria->compare('orig.type', $this->type, true);\r\n```\r\n2. 在model內沒有用relations，或其他需要join的時候\r\n```php=\r\n$criteria->join = 'LEFT JOIN member b ON b.id = t.upper';\r\n$criteria->compare('b.username', $this->upper_username, true);\r\n```\r\n在return的地方兩者都需要在attributes內加上排序用\r\n```php=\t\r\nreturn new CActiveDataProvider('ModelName', array(\r\n        'criteria' => $criteria,\r\n        'sort' => array(\r\n            'attributes' => array(\r\n                'type' => array(\r\n                    'asc' => 'orig.type',\r\n                    'desc' => 'orig.type DESC',\r\n                ),\r\n                '*',\r\n            ),\r\n        ),\r\n    ));\r\n```\r\nview的地方\r\n為了可以查詢，要加上name\r\n如果是用relations的話，沒有特別要寫html就不需要value了\r\n```php=\r\n[\r\n    'name' => 'type',\r\n    'type' => 'raw', //value return 的才會變html\r\n    'header' => '類型',\r\n    'headerHtmlOptions' => array(\"class\" => 'span3'),\r\n    'value' => function ($data)\r\n    {\r\n        return \"<h3>\".$data->orig->type.\"</h3>\"\r\n    }\r\n],\r\n```",
      "data": {
        "title": "常用的程式碼 - Yii",
        "date": "2022-07-13 11:37:14",
        "tags": [
          "常用的程式碼"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "chang-yong-de-cheng-shi-ma-yii"
    },
    {
      "content": "\r\n<span class=\"subtitle\">隨筆</span>\r\n有遇過kill -15 PID 結果砍不掉的問題\r\n但是程式整個卡住，無法確定是不是因為程式跑太久，或是有太多連線導致程式無法正常結束\r\n此時就會用kill -9強制結束\r\n但kill -9 無法砍掉子行程，會讓子行程的父PID變成1\r\n如果kill -15不行，就-9把master砍掉，再把底下的子行程用-15砍掉，看能不能全砍\r\n\r\nps -ef | grep webServer 看這隻程式與子行程\r\n所有人 PID 父PID(最大是1) unknown 執行時間 unknown 執行多久 後面參數不確定\r\nps aux | grep master 看所有master",
      "data": {
        "title": "kill -9 v.s. kill -15",
        "date": "2022-07-11 16:43:13",
        "tags": [
          "program"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "kill-9-vs-kill-15"
    },
    {
      "content": "\r\n<h1>PHP</h1>\r\n\r\nDateTime\r\n```php=\r\n//拿現在時間\r\n$dt = new \\DateTime('NOW');\r\n//拿月初 2022-07-01 00:00:00\r\n$dateStart = $dt->format('Y-m-01 00:00:00');\r\n//拿月底 2022-07-31 23:59:59\r\n$dateEnd = $dt->format('Y-m-t 23:59:59');\r\n//拿上個月月初\r\n$dateStart = date('Y-m-01 00:00:00', strtotime('-1 month'));\r\n//拿上個月月底\r\n$dateEnd = date('Y-m-t 23:59:59', strtotime($dateStart));\r\n\r\n//日期轉成星期幾\r\n$day = DayOfWeekToChineseDay(date('w', strtotime($dateStart)));\r\n$dateStartShow = date(\"Y-m-d({$day}) H:i:s\", strtotime($dateStart));\r\n    \r\nfunction DayOfWeekToChineseDay($day)\r\n{\r\n    switch ($day) {\r\n        case \"0\":\r\n            return \"日\";\r\n        case \"1\":\r\n            return \"一\";\r\n        case \"2\":\r\n            return \"二\";\r\n        case \"3\":\r\n            return \"三\";\r\n        case \"4\":\r\n            return \"四\";\r\n        case \"5\":\r\n            return \"五\";\r\n        case \"6\":\r\n            return \"六\";\r\n    }\r\n}\r\n```\r\n\r\n密碼驗證\r\n```php=\r\n// 線上生成的都用這個，很好用\r\n// https://phppasswordhash.com/\r\n// 產生PWD\r\npassword_hash($pwd, PASSWORD_DEFAULT)\r\n// 驗證用\r\npassword_verify($pwd, $hash)，正確回傳true\r\nif (!password_verify($pwd, $hash))\r\n    throw new Exception(\"錯誤\");\r\n```\r\n\r\nArray\r\n```php=\r\n//array_chunk($arr, $len, bool $preserve_keys) 切割陣列內元素成子陣列，preserve_keys = true會保留KEY\r\n$d = [1,2,3,4];\r\nprint_r(array_chunk($d, 2));\r\noutput: [[1,2], [3,4]]\r\n\r\n//implode(\" \", $arr) Array to String connects with needles\r\n$d = [1,2,3,4];\r\nprint_r(implode(\" \", $d));\r\noutput: 1 2 3 4\r\n\r\n//explode(\" \", $str) String to Array split with needles\r\n$s = \"1 2 3 4\";\r\nprint_r(explode(\" \",$s));\r\noutput: [1,2,3,4]\r\n```",
      "data": {
        "title": "常用的程式碼 - PHP",
        "date": "2022-07-07 14:09:00",
        "tags": [
          "常用的程式碼"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "chang-yong-de-cheng-shi-ma-ji-lu"
    },
    {
      "content": "\r\n<span class=\"subtitle\">拿來測CSS方便我寫作 珍香</span>\r\n```php=\r\n$j = 1;\r\n$j += 2;\r\nconsole.log(\"hji\");\r\n```",
      "data": {
        "title": "測試CSS",
        "date": "2022-06-23 15:35:12",
        "tags": [],
        "published": false,
        "hideInList": true,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "ce-shi-css"
    },
    {
      "content": "<span class=\"subtitle\">前言</span> <span class=\"content\">個人隨筆，簡單紀錄一下會用到的時機</span>\r\n\r\n---\r\nSQL = RDBMS，關聯式資料庫\r\nNoSQL 就是相反的非關聯式資料庫\r\n\r\nSQL可以保證資料的完整性，永久性，還可以保證獨一性，對於需要用到有互相關連的資料會比較適合，像是作者跟文章，然後這作者又有自己的設定檔、簡介等等情況，用SQL會比較方便。\r\nSQL的Schema需要先設計好，不然之後要更改的時候如果有資料了會很麻煩，因為資料型態要一樣。\r\n不好用於分散式資料庫，因為不同資料彼此之間可能會有關聯，如果分散在不同資料庫，查詢起來會很麻煩，通常要升級效能的話直接升級伺服器會比較好（vertical scaling）。\r\n\r\nNoSQL的話就像一堆文件存在伺服器內，每個文件的資料格式不用一樣，目前還沒有遇到會想使用NoSQL的情況，用於分散式資料庫會比較方便（horizontal scaling），畢竟都是存文件，也不會需要注意一致性跟完整性的問題，所以與其升級一台主機的效能，不如多開幾台幫忙存就好了。",
      "data": {
        "title": "SQL vs NoSQL",
        "date": "2022-06-23 15:03:57",
        "tags": [
          "program"
        ],
        "published": true,
        "hideInList": false,
        "feature": null,
        "isTop": false
      },
      "isEmpty": false,
      "excerpt": "",
      "abstract": "",
      "fileName": "sql-vs-nosql"
    }
  ],
  "tags": [
    {
      "index": -1,
      "name": "常用的程式碼",
      "slug": "nXMUqZgXX",
      "used": true
    },
    {
      "index": -1,
      "name": "program",
      "slug": "hBJuzNhU4",
      "used": true
    }
  ],
  "menus": [
    {
      "link": "/",
      "name": "Index",
      "openType": "Internal"
    },
    {
      "link": "/archives",
      "name": "Archives",
      "openType": "Internal"
    },
    {
      "link": "/tags",
      "name": "Tags",
      "openType": "Internal"
    }
  ]
}